{
  "id": "category-normalization-gotcha",
  "title": "Storage vs UI Category Value Normalization",
  "category": "troubleshooting",
  "createdAt": "2026-01-28T23:15:00.000Z",
  "tags": ["typescript", "data-mapping", "service-layer", "categories"],
  "content": "## Gotcha: Storage Format vs UI Type Mismatch\n\n### Problem\nKnowledge entries stored in JSON files used plural category names ('patterns', 'architecture', 'troubleshooting') while the TypeScript UI types expected singular forms ('pattern', 'gotcha', 'decision', 'learning'). This caused entries to fail type validation and not render correctly.\n\n### Solution\nAdd a normalization helper at the service layer that maps stored values to expected UI values:\n\n```typescript\nfunction normalizeCategory(category: string | undefined): KnowledgeCategory {\n  const categoryMap: Record<string, KnowledgeCategory> = {\n    patterns: 'pattern',\n    architecture: 'pattern',\n    troubleshooting: 'gotcha'\n  }\n  return categoryMap[category] || (category as KnowledgeCategory) || 'learning'\n}\n```\n\n### Key Insight\nWhen reading data from storage into typed structures:\n1. Always validate/normalize at the boundary (service layer)\n2. Keep the normalization function pure and testable\n3. Provide sensible defaults for missing or unknown values\n4. Don't modify stored data - normalize on read\n\n### Key Files\n- `src/main/services/knowledge-service.ts` - Service layer with normalization",
  "relatedIssues": [48],
  "autoGenerated": true
}
