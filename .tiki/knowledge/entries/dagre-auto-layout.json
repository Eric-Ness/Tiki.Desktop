{
  "id": "dagre-auto-layout",
  "title": "Dagre Auto-Layout for React Flow",
  "category": "patterns",
  "createdAt": "2026-01-28T19:45:00.000Z",
  "tags": ["dagre", "react-flow", "layout", "workflow"],
  "content": "## Pattern: Auto-Layout with Dagre in React Flow\n\n### Overview\nDagre provides directed graph layout for arranging nodes automatically.\n\n### Implementation\n```typescript\nimport dagre from 'dagre'\nimport { Node, Edge } from '@xyflow/react'\n\nexport const NODE_WIDTH = 180\nexport const NODE_HEIGHT = 80\n\nexport function getLayoutedElements(nodes: Node[], edges: Edge[]): { nodes: Node[]; edges: Edge[] } {\n  if (nodes.length === 0) return { nodes: [], edges }\n\n  const dagreGraph = new dagre.graphlib.Graph()\n  dagreGraph.setDefaultEdgeLabel(() => ({}))\n  dagreGraph.setGraph({ rankdir: 'TB', nodesep: 50, ranksep: 80 })\n\n  // Add nodes with dimensions\n  nodes.forEach((node) => {\n    const width = node.type === 'issue' ? 160 : node.type === 'ship' ? 100 : NODE_WIDTH\n    const height = node.type === 'issue' || node.type === 'ship' ? 60 : NODE_HEIGHT\n    dagreGraph.setNode(node.id, { width, height })\n  })\n\n  // Add edges\n  edges.forEach((edge) => {\n    dagreGraph.setEdge(edge.source, edge.target)\n  })\n\n  dagre.layout(dagreGraph)\n\n  // Apply positions (dagre gives center, React Flow expects top-left)\n  const layoutedNodes = nodes.map((node) => {\n    const nodeWithPosition = dagreGraph.node(node.id)\n    const width = node.type === 'issue' ? 160 : node.type === 'ship' ? 100 : NODE_WIDTH\n    const height = node.type === 'issue' || node.type === 'ship' ? 60 : NODE_HEIGHT\n    return {\n      ...node,\n      position: {\n        x: nodeWithPosition.x - width / 2,\n        y: nodeWithPosition.y - height / 2\n      }\n    }\n  })\n\n  return { nodes: layoutedNodes, edges }\n}\n```\n\n### Key Options\n- `rankdir: 'TB'` - Top to bottom layout\n- `nodesep: 50` - Horizontal spacing between nodes\n- `ranksep: 80` - Vertical spacing between ranks\n\n### Key Files\n- `src/renderer/src/lib/workflow-layout.ts`\n\n### Gotchas\n- Dagre positions are center-based; React Flow expects top-left corner\n- Different node types may need different dimensions\n- Re-run layout when nodes/edges change, use useMemo for performance",
  "relatedIssues": [6]
}
