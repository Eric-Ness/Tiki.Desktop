{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://tiki.dev/schemas/knowledge.schema.json",
  "title": "Tiki Knowledge Entry",
  "description": "Schema for individual knowledge entries in .tiki/knowledge/entries/",
  "type": "object",
  "required": ["id", "title", "content", "created", "source", "keywords", "confidence"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^K[0-9]+$",
      "description": "Knowledge entry identifier (e.g., 'K001', 'K002')"
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "description": "Brief title summarizing the knowledge"
    },
    "content": {
      "type": "string",
      "minLength": 1,
      "description": "Detailed knowledge content in markdown format"
    },
    "created": {
      "type": "string",
      "format": "date-time",
      "description": "Creation timestamp"
    },
    "updated": {
      "type": "string",
      "format": "date-time",
      "description": "Last update timestamp"
    },
    "source": {
      "type": "object",
      "description": "Source of this knowledge entry",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["issue", "manual", "debug-session", "execution"],
          "description": "How this knowledge was captured"
        },
        "issueNumber": {
          "type": "integer",
          "minimum": 1,
          "description": "GitHub issue number if captured from issue"
        },
        "issueTitle": {
          "type": "string",
          "description": "Title of source issue"
        },
        "debugSessionId": {
          "type": "string",
          "description": "Debug session ID if captured from debugging"
        },
        "phaseNumber": {
          "type": "integer",
          "minimum": 1,
          "description": "Phase number if captured during execution"
        }
      }
    },
    "keywords": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "description": "Keywords for matching and retrieval"
    },
    "related": {
      "type": "object",
      "description": "Related references",
      "properties": {
        "issues": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 1
          },
          "description": "Related GitHub issue numbers"
        },
        "adrs": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[0-9]{3}$"
          },
          "description": "Related ADR numbers (e.g., '001', '002')"
        },
        "files": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Related file paths in the codebase"
        },
        "knowledge": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^K[0-9]+$"
          },
          "description": "Related knowledge entry IDs"
        }
      }
    },
    "confidence": {
      "type": "string",
      "enum": ["high", "medium", "low"],
      "description": "Confidence level in this knowledge"
    },
    "autoGenerated": {
      "type": "boolean",
      "description": "Whether this entry was auto-generated during execution"
    },
    "archived": {
      "type": "boolean",
      "description": "Whether this entry has been archived"
    },
    "archivedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Archive timestamp if archived"
    }
  },
  "additionalProperties": false
}
